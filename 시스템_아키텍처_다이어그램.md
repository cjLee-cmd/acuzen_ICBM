# 약물감시 시스템 아키텍처 다이어그램

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           약물감시 시스템 (Drug Surveillance System)                │
├─────────────────────────────────────────────────────────────────────────────┤
│                                 사용자 인터페이스                                 │
├─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┤
│ 대시보드    │ 사례관리   │ 사례상세   │ 긴급사례   │ 사용자관리  │ AI모델관리 │ 감사로그   │ 시스템모니터링│
│Dashboard│CaseMan  │CaseDetail│Critical │UserMgmt │AIModel  │AuditLogs│Monitoring │
│         │agement  │         │Cases    │         │Mgmt     │         │           │
└─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                                 React Frontend                              │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐            │
│  │   App.tsx       │  │   Components    │  │     Hooks       │            │
│  │   (Router)      │  │   shadcn/ui     │  │   useQuery      │            │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘            │
│                                                                             │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐            │
│  │   TanStack      │  │   Tailwind      │  │    Wouter       │            │
│  │   Query         │  │   CSS           │  │   (Routing)     │            │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘            │
└─────────────────────────────────────────────────────────────────────────────┘
                                     │ HTTP API Calls
                                     ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                              Express.js Backend                             │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────────┤
│  │                            Middleware Layer                             │
│  │  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐          │
│  │  │ Auth    │ │  Role   │ │  Rate   │ │ Helmet  │ │ Audit   │          │
│  │  │         │ │ Control │ │ Limit   │ │Security │ │Logging  │          │
│  │  └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘          │
│  └─────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────────┤
│  │                             API Routes                                  │
│  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐        │
│  │  │   /api/users    │  │   /api/cases    │  │/api/ai-models   │        │
│  │  │                 │  │                 │  │                 │        │
│  │  └─────────────────┘  └─────────────────┘  └─────────────────┘        │
│  │                                                                         │
│  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐        │
│  │  │/api/predictions │  │ /api/audit-logs │  │   /api/auth     │        │
│  │  │                 │  │                 │  │                 │        │
│  │  └─────────────────┘  └─────────────────┘  └─────────────────┘        │
│  └─────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────────┤
│  │                          Service Layer                                  │
│  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐        │
│  │  │   storage.ts    │  │  ai-service.ts  │  │    types.ts     │        │
│  │  │   (Data Access) │  │   (AI Logic)    │  │ (Type Defs)     │        │
│  │  └─────────────────┘  └─────────────────┘  └─────────────────┘        │
│  └─────────────────────────────────────────────────────────────────────────┤
└─────────────────────────────────────────────────────────────────────────────┘
                                     │
                                     ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                            External Services                                │
│                                                                             │
│  ┌─────────────────────────────────┐    ┌─────────────────────────────────┐│
│  │          OpenAI GPT-5           │    │        Database Layer          ││
│  │                                 │    │                                 ││
│  │  ┌─────────────────────────────┐│    │  ┌─────────────────────────────┐││
│  │  │ • 심각도 평가                 ││    │  │      Drizzle ORM            │││
│  │  │ • 위험 요인 식별              ││    │  │                             │││
│  │  │ • 규제 권고사항               ││    │  └─────────────────────────────┘││
│  │  │ • 신뢰도 점수                 ││    │                ▼                ││
│  │  └─────────────────────────────┘│    │  ┌─────────────────────────────┐││
│  └─────────────────────────────────┘    │  │     SQLite (Dev)           │││
│                                         │  │   PostgreSQL (Prod)        │││
│                                         │  │                             │││
│                                         │  │ • users                     │││
│                                         │  │ • cases                     │││
│                                         │  │ • ai_predictions            │││
│                                         │  │ • audit_logs                │││
│                                         │  │ • ai_models                 │││
│                                         │  └─────────────────────────────┘││
│                                         └─────────────────────────────────┘│
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                              Shared Resources                               │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────────┤
│  │                            /shared/schema.ts                            │
│  │                                                                         │
│  │  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐          │
│  │  │ Schema  │ │ Types   │ │ Zod     │ │ Relations│ │Constants│          │
│  │  │Definitions│Definition│Validation│          │         │          │
│  │  └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘          │
│  └─────────────────────────────────────────────────────────────────────────┤
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                              Security Features                              │
│                                                                             │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐            │
│  │ Session-based   │  │  Role-based     │  │   Audit Trail   │            │
│  │ Authentication  │  │  Access Control │  │   Logging       │            │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘            │
│                                                                             │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐            │
│  │   Soft Delete   │  │   Rate Limiting │  │   CSRF          │            │
│  │   (Compliance)  │  │                 │  │   Protection    │            │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘            │
└─────────────────────────────────────────────────────────────────────────────┘

데이터 흐름:
1. 사용자 → React Frontend (UI 인터랙션)
2. Frontend → Express API (HTTP 요청)
3. API → Middleware (인증, 권한, 로깅)
4. API Routes → Service Layer (비즈니스 로직)
5. Service Layer → Database/AI Service (데이터 처리)
6. AI Service → OpenAI GPT-5 (분석 요청)
7. 응답 역순으로 전달

주요 보안 계층:
• 세션 기반 인증 (Express Session + PostgreSQL Store)
• 역할 기반 접근 제어 (USER/REVIEWER/ADMIN)
• API Rate Limiting
• 감사 로그 추적
• 소프트 삭제 (규제 준수)
```