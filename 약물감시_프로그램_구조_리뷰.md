# 약물감시 시스템 프로그램 구조 리뷰

## 1. 개요

이 프로그램은 **Korean Drug Surveillance System (약물감시 시스템)** 으로, 의약품 부작용 보고서를 관리하고 AI 기반 분석을 제공하는 약물감시(pharmacovigilance) 플랫폼입니다.

### 핵심 목적
- 약물 이상반응(Adverse Drug Reaction) 사례 수집 및 관리
- AI 기반 위험도 분석 및 예측
- 규제 기관 준수를 위한 감사 추적
- 역할 기반 접근 제어를 통한 보안 관리

## 2. 기술 스택 아키텍처

### 프론트엔드
- **React 18** + **TypeScript**: 최신 React 기반 SPA
- **Vite**: 빠른 개발 서버 및 빌드 도구
- **Tailwind CSS**: 유틸리티 기반 스타일링
- **shadcn/ui**: 고품질 UI 컴포넌트 라이브러리
- **Wouter**: 경량 라우팅 라이브러리
- **TanStack Query**: 서버 상태 관리

### 백엔드
- **Express.js** + **Node.js**: RESTful API 서버
- **TypeScript**: 타입 안전성 보장
- **Drizzle ORM**: 타입 세이프 데이터베이스 ORM
- **SQLite**: 개발용 데이터베이스 (프로덕션은 PostgreSQL 권장)
- **Express Session**: 세션 기반 인증

### AI 통합
- **OpenAI GPT-5**: 2025년 8월 릴리스된 최신 모델
- 부작용 심각도 평가
- 위험 요인 식별
- 규제 권고사항 생성

## 3. 디렉토리 구조 분석

```
acuzen_ICBM/
├── client/                 # 프론트엔드 React 애플리케이션
│   ├── src/
│   │   ├── App.tsx        # 메인 애플리케이션 컴포넌트
│   │   ├── components/    # UI 컴포넌트
│   │   ├── pages/         # 페이지 컴포넌트
│   │   ├── hooks/         # 커스텀 React 훅
│   │   └── lib/           # 유틸리티 라이브러리
│   └── index.html         # HTML 엔트리 포인트
├── server/                # 백엔드 Express 서버
│   ├── index.ts          # 서버 엔트리 포인트
│   ├── routes.ts         # API 라우트 및 미들웨어
│   ├── db.ts            # 데이터베이스 연결
│   ├── storage.ts       # 데이터 액세스 레이어
│   ├── ai-service.ts    # AI 통합 서비스
│   ├── seed.ts          # 테스트 데이터 시드
│   └── types.ts         # 타입 정의
├── shared/               # 공유 코드
│   └── schema.ts        # 데이터베이스 스키마 및 검증
├── migrations/          # 데이터베이스 마이그레이션
├── tests/              # 테스트 파일
└── 설정 파일들...
```

## 4. 데이터베이스 스키마 분석

### 주요 테이블

#### 1. `users` - 사용자 관리
```sql
- id: 사용자 고유 식별자
- email: 이메일 (로그인 계정)
- name: 사용자 이름
- password: 암호화된 비밀번호
- role: 역할 (USER/REVIEWER/ADMIN)
- organization: 소속 기관
- isActive: 활성화 상태
```

#### 2. `cases` - 부작용 사례 관리
```sql
- id: 사례 고유 식별자
- caseNumber: 사례 번호
- patientAge: 환자 연령
- patientGender: 환자 성별
- drugName: 약물명
- drugDosage: 약물 용량
- adverseReaction: 이상반응
- severity: 심각도 (Low/Medium/High/Critical)
- status: 처리 상태 (긴급/검토 필요/처리중/완료)
- reporterId: 보고자 ID
- 소프트 삭제 필드 (규제 준수)
```

#### 3. `ai_predictions` - AI 분석 결과
```sql
- caseId: 연관된 사례 ID
- modelName: 사용된 AI 모델명
- confidence: 예측 신뢰도
- prediction: 예측 결과 (JSON)
- humanReviewed: 인간 검토 여부
```

#### 4. `audit_logs` - 감사 로그
```sql
- userId: 작업 수행 사용자
- action: 수행된 작업
- resource: 대상 리소스
- details: 상세 정보
- severity: 심각도 (INFO/WARNING/HIGH)
```

### 규제 준수 기능
- **소프트 삭제**: 데이터 보존 의무 준수
- **감사 추적**: 모든 활동 기록
- **역할 기반 접근**: 데이터 보안 강화

## 5. 주요 기능 모듈

### 5.1 인증 및 권한 관리
- **개발 환경**: 인증 우회 (보안 경고 포함)
- **프로덕션**: 세션 기반 인증
- **역할별 접근 제어**:
  - USER: 기본 사용자
  - REVIEWER: 사례 검토자
  - ADMIN: 시스템 관리자

### 5.2 사례 관리 (CaseManagement)
- 부작용 사례 등록/수정/조회
- 상태별 필터링 및 검색
- 일괄 처리 기능
- 소프트 삭제 지원

### 5.3 AI 분석 서비스
- GPT-5 기반 자동 분석
- 심각도 평가 자동화
- 신뢰도 점수 제공
- 인간 검토 워크플로우

### 5.4 대시보드 (Dashboard)
- 실시간 통계
- 최근 사례 현황
- 위험 트렌드 분석
- 시각화 차트

### 5.5 사용자 관리 (UserManagement)
- 관리자 전용 기능
- 사용자 계정 생성/수정
- 권한 변경
- 활동 모니터링

### 5.6 감사 로그 (AuditLogs)
- 시스템 활동 추적
- 규제 준수 보고
- 보안 이벤트 모니터링

## 6. API 구조

### REST 엔드포인트 패턴
```
/api/users          - 사용자 관리
/api/cases          - 사례 관리
/api/ai-predictions - AI 분석 결과
/api/audit-logs     - 감사 로그
/api/ai-models      - AI 모델 관리
```

### 보안 미들웨어
- **Rate Limiting**: API 호출 제한
- **Helmet**: 보안 헤더 설정
- **CSRF 보호**: 크로스 사이트 요청 위조 방지
- **세션 관리**: PostgreSQL 세션 저장소

## 7. 현재 시스템의 강점

### 7.1 기술적 장점
- **타입 안전성**: TypeScript 전면 사용
- **현대적 UI**: React 18 + shadcn/ui
- **확장 가능한 아키텍처**: 마이크로서비스 준비
- **AI 통합**: 최신 GPT-5 모델 활용

### 7.2 규제 준수
- **감사 추적**: 완전한 활동 로깅
- **데이터 보존**: 소프트 삭제 구현
- **역할 기반 접근**: 보안 요구사항 충족
- **세션 보안**: 안전한 인증 시스템

### 7.3 사용자 경험
- **직관적 UI**: 의료진 친화적 인터페이스
- **실시간 대시보드**: 즉시 현황 파악 가능
- **다국어 지원**: 한국어 우선 설계
- **모바일 반응형**: 다양한 디바이스 지원

## 8. 개선이 필요한 영역

### 8.1 ICSR 표준 준수 부족
현재 시스템은 ICH E2B(R3) 표준을 완전히 준수하지 않음:
- E2B(R3) XML 생성/검증 기능 부재
- MedDRA 용어 체계 미통합
- 규제 기관 제출 API 부재 (MFDS/FDA/EMA)
- 배치 처리 기능 제한
- 표준 ICSR 데이터 필드 부분 지원

### 8.2 확장성 고려사항
- 대용량 데이터 처리 최적화 필요
- 분산 처리 아키텍처 도입 검토
- 캐싱 전략 개선
- 데이터베이스 샤딩 고려

### 8.3 보안 강화
- API 키 관리 체계 구축
- 더 강력한 암호화 적용
- 침입 탐지 시스템 도입
- 정기 보안 감사 체계

## 9. 배포 및 운영

### 개발 환경
- **포트**: 5000번
- **인증 우회**: 개발 편의성
- **핫 리로드**: Vite 개발 서버

### 프로덕션 배포
- **빌드 스크립트**: `build-for-publish.sh`
- **정적 배포**: Replit 환경 최적화
- **환경 변수**: SESSION_SECRET, OPENAI_API_KEY 필수
- **데이터베이스**: PostgreSQL 권장

## 10. 결론

이 약물감시 시스템은 현대적인 웹 기술 스택을 기반으로 구축된 종합적인 pharmacovigilance 플랫폼입니다. 

**주요 강점**:
- 견고한 기술 아키텍처
- AI 기반 자동화
- 규제 준수 기능
- 사용자 친화적 인터페이스

**개선 필요 영역**:
- 국제 표준(ICSR) 완전 준수
- 대규모 데이터 처리 최적화
- 보안 체계 강화

전반적으로 잘 설계된 시스템이지만, 글로벌 규제 환경에서의 완전한 운영을 위해서는 ICSR 표준 준수 및 확장성 개선이 필요합니다.